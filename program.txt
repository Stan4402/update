<?php
/**
 * File Scanner for Backdoor Detection
 *
 * Scan directories for potentially malicious files.
 */

function scan_directory($directory) {
    $results = [];

    // Open the directory
    $iterator = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($directory));
    foreach ($iterator as $file) {
        // Skip directories
        if ($file->isDir()) {
            continue;
        }

        $file_path = $file->getPathname();
        $file_content = file_get_contents($file_path);

        // Check for suspicious patterns
        $patterns = [
            '/base64_encode\s*\(/', // base64_encode()
            '/base64_decode\s*\(/', // base64_decode()
            '/FATHURFREAKZ/',        // Specific keyword
            '/eval\s*\(/',          // eval()
            '/system\s*\(/',        // system()
            '/gzinflate\s*\(/',     // gzinflate()
            '/str_rot13\s*\(/',     // str_rot13()
            '/convert_uu\s*\(/',    // convert_uu()
            '/shell_data/',           // shell_data
            '/getimagesize\s*\(/',  // getimagesize()
            '/magicboom/',            // Specific keyword
            '/mysql_connect\s*\(/', // mysql_connect()
            '/mysqli_connect\s*\(/',// mysqli_connect()
            '/basename\s*\(/',      // basename()
            '/exec\s*\(/',          // exec()
            '/shell_exec\s*\(/',    // shell_exec()
            '/fwrite\s*\(/',        // fwrite()
            '/str_replace\s*\(/',   // str_replace()
            '/mail\s*\(/',          // mail()
            '/file_get_contents\s*\(/', // file_get_contents()
            '/url_get_contents\s*\(/',  // url_get_contents()
            '/move_uploaded_file\s*\(/', // move_uploaded_file()
            '/symlink\s*\(/',       // symlink()
            '/substr\s*\(/',        // substr()
            '/pathinfo\s*\(/',      // pathinfo()
            '/__file__/',             // __file__
            '/__halt_compiler/'       // __halt_compiler
        ];

        foreach ($patterns as $pattern) {
            if (preg_match($pattern, $file_content)) {
                $results[] = $file_path;
                break;
            }
        }
    }

    return $results;
}

// Define the root directory to scan
$root_directory = __DIR__;

// Run the scan
$backdoor_files = scan_directory($root_directory);

// Display results
echo "<h1>Backdoor Scanner Results</h1>";
if (!empty($backdoor_files)) {
    echo "<p>Suspicious files detected:</p><ul>";
    foreach ($backdoor_files as $file) {
        echo "<li>" . htmlspecialchars($file) . "</li>";
    }
    echo "</ul>";
} else {
    echo "<p>No suspicious files detected.</p>";
}
?>
